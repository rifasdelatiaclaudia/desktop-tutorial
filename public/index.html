<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RifasDeLatiaclaudia üéüÔ∏è</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <header style="text-align:center;">
      <h1>RifasDeLatiaclaudia</h1>
      <p class="subtitle">
        Participa por una Land Rover Discovery 3 y dos premios de $500.000 ¬∑ $3.000 por n√∫mero
      </p>
      <p style="margin:6px 0;">
        S√≠guenos en TikTok:
        <a href="https://www.tiktok.com/@zkglshwkb..567" target="_blank" rel="noopener">
          RifasDeLatiaclaudia
        </a>
      </p>
      <p style="margin:4px 0;">
        üì± WhatsApp: <a href="https://wa.me/56983303327" target="_blank">+56 9 8330 3327</a><br>
        üì∏ Instagram: <a href="https://www.instagram.com/rifasdelatiaclaudia" target="_blank">@rifasdelatiaclaudia</a>
      </p>
    </header>

    <main>
      <section class="card">
        <h2>Comprar n√∫mero</h2>
        <p>No necesitas elegir n√∫mero. Al comprar se te asigna uno autom√°ticamente.</p>

        <form id="formRifa">
          <input type="text" id="nombre" placeholder="Tu nombre completo" required />
          <input type="email" id="correo" placeholder="Tu correo electr√≥nico" required />
          <input type="tel" id="telefono" placeholder="Tu n√∫mero de tel√©fono" required />
          <button id="btnComprar" type="submit">Comprar n√∫mero</button>
        </form>

        <div id="resultado" class="oculto">
          <h3>¬°Gracias por participar! üéâ</h3>
          <p>Tu n√∫mero asignado es:</p>
          <div class="numero" id="numeroAsignado"></div>
          <p class="detalle">Guarda este n√∫mero. Te servir√° para verificar tu premio.</p>
        </div>
      </section>
    </main>

    <footer style="margin-top:18px; font-size:13px; text-align:center;">
      <p>Compra segura ¬∑ Pago por Flow ¬∑ Rifas organizadas por La T√≠a Claudia</p>
    </footer>
  </div>

  <script src="script.js"></script>
</body>
</html>
<script>
document.getElementById("formRifa").addEventListener("submit", async (e) => {
  e.preventDefault();

  const nombre = document.getElementById("nombre").value.trim();
  const correo = document.getElementById("correo").value.trim();
  const telefono = document.getElementById("telefono").value.trim();

  if (!nombre || !correo || !telefono) {
    alert("Por favor completa todos los campos.");
    return;
  }

  try {
    // Generar n√∫mero aleatorio entre 1 y 100000 (empezando por los m√°s bajos)
    const numeroAsignado = Math.floor(Math.random() * 100000) + 1;

    // Mostrar n√∫mero en pantalla
    document.getElementById("numeroAsignado").textContent = numeroAsignado;
    document.getElementById("resultado").classList.remove("oculto");

    // Crear pago en Flow
    const response = await fetch("/crear-pago", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        nombre,
        correo,
        telefono,
        numero: numeroAsignado,
        monto: 3000,
      }),
    });

    const data = await response.json();

    if (data.url) {
      window.location.href = data.url; // redirige al pago de Flow
    } else {
      alert("Hubo un problema al generar el pago.");
    }
  } catch (error) {
    console.error("Error:", error);
    alert("No se pudo procesar la compra.");
  }
});
</script>